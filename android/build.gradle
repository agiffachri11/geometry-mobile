// build gradle root

buildscript {
    ext {
        buildToolsVersion = "33.0.0"
        minSdkVersion = 21
        compileSdkVersion = 34
        targetSdkVersion = 34
        kotlinVersion = "1.8.10"
        ndkVersion = "23.1.7779620"
        kotlinJvmTarget = "11"
        androidXVersion = "1.0.0"
        androidXCore = "1.7.0"
        kotlinCompilerVersion = "1.8.10"
        kotlin_version = kotlinVersion
        fbjniVersion = "0.3.0"
        reactNativeVersion = "0.72.17"
    }
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath('com.android.tools.build:gradle:8.1.0') 
        classpath('com.facebook.react:react-native-gradle-plugin')
        classpath 'com.google.gms:google-services:4.3.15'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"
    }
}

configurations.all {
    resolutionStrategy {
        force "com.facebook.fbjni:fbjni:${fbjniVersion}"
        force "com.facebook.react:react-android:${reactNativeVersion}"
        force "org.jetbrains.kotlin:kotlin-stdlib:${kotlinVersion}"
        force "org.jetbrains.kotlin:kotlin-stdlib-jdk8:${kotlinVersion}"
        force "org.jetbrains.kotlin:kotlin-stdlib-jdk7:${kotlinVersion}"
        force "org.jetbrains.kotlin:kotlin-android-extensions:${kotlinVersion}"
    }
}

allprojects {
    configurations.all {
        resolutionStrategy {
            force "com.facebook.fbjni:fbjni:${fbjniVersion}"
            force "com.facebook.react:react-android:${reactNativeVersion}"
            force "org.jetbrains.kotlin:kotlin-stdlib:${kotlinVersion}"
            force "org.jetbrains.kotlin:kotlin-stdlib-jdk8:${kotlinVersion}"
            force "org.jetbrains.kotlin:kotlin-stdlib-jdk7:${kotlinVersion}"
            force "org.jetbrains.kotlin:kotlin-android-extensions:${kotlinVersion}"
        }
    }
    repositories {
        exclusiveContent {
            filter {
                includeGroup "com.facebook.react"
                includeGroup "com.facebook.fbjni"
            }
            forRepository {
                maven {
                    url "$rootDir/../node_modules/react-native/android"
                }
            }
        }
        maven {
            url("$rootDir/../node_modules/jsc-android/dist")
        }
        maven {
            url("$rootDir/../node_modules/expo/android/maven")
        }
        google()
        mavenCentral()
        maven { url 'https://www.jitpack.io' }
    }
}

subprojects { subproject ->
    afterEvaluate {
        if ((subproject.plugins.hasPlugin('android') || subproject.plugins.hasPlugin('android-library'))) {
            android {
                compileOptions {
                    sourceCompatibility JavaVersion.VERSION_11
                    targetCompatibility JavaVersion.VERSION_11
                }
            }

            // For Kotlin projects
            if (subproject.plugins.hasPlugin('kotlin-android')) {
                // kotlin {
                //     jvmToolchain(11)
                // }
                
                tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
                    kotlinOptions {
                        jvmTarget = "11"
                        // Update Kotlin language version to 1.9 to support data objects
                        languageVersion = "1.8"
                        apiVersion = "1.8"
                    }
                }
            }
        }
    }
}

